// Generated by IcedCoffeeScript 1.4.0c
(function() {
  var broadcast, ports, sse;

  ports = [];

  self.addEventListener('connect', (function(e) {
    var port;
    ports.push(port = e.ports[0]);
    return port.start();
  }));

  broadcast = function(name) {
    return function(event) {
      var msg, port, _i, _len, _results;
      msg = {
        data: JSON.parse(event.data),
        name: name
      };
      _results = [];
      for (_i = 0, _len = ports.length; _i < _len; _i++) {
        port = ports[_i];
        _results.push(port.postMessage(msg));
      }
      return _results;
    };
  };

  sse = new EventSource("/sseupdate");

  sse.addEventListener('changed', broadcast('changed'), false);

  sse.addEventListener('inbox', broadcast('inbox'), false);

  sse.addEventListener('deleted', broadcast('deleted'), false);

  sse.addEventListener('new', broadcast('new'), false);

}).call(this);
